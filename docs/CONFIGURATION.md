# ClassMetrix Configuration Guide

This document provides comprehensive configuration options for customizing ClassMetrix reports.

## ðŸŽ¯ API Design Philosophy

ClassMetrix uses a **comprehensive-by-default** approach with explicit modifiers:

- **Default Behavior**: Comprehensive scanning (inheritance + modules enabled)
- **`.strict()`**: Class-only scanning (disables inheritance & modules)
- **`.with_private()`**: Include private methods and constants
- **Method Chaining**: All modifiers can be chained in any order

```ruby
# Examples of all combinations
ClassMetrix.extract(:constants).from([User, Admin]).to_markdown                # Comprehensive (default)
ClassMetrix.extract(:constants).from([User, Admin]).strict.to_markdown        # Class-only
ClassMetrix.extract(:constants).from([User, Admin]).with_private.to_markdown   # Comprehensive + private
ClassMetrix.extract(:constants).from([User, Admin]).strict.with_private.to_markdown # Class-only + private
```

## ðŸ“ Markdown Report Configuration

### Basic Configuration

```ruby
ClassMetrix.extract(:constants)
  .from([User, Admin])
  .to_markdown(
    "report.md",                  # File path
    title: "Custom Report Title", # Report title

    # Content sections
    show_metadata: true,          # Show title and report info
    show_classes: true,           # Show "Classes Analyzed" section
    show_extraction_info: true,   # Show "Extraction Types" section
    show_missing_summary: false,  # Show missing behaviors summary

    # Footer configuration
    show_footer: true,            # Show footer
    footer_style: :detailed,      # :default, :minimal, :detailed
    show_timestamp: true,         # Include generation timestamp
    custom_footer: "Custom note", # Custom footer message

    # Table formatting
    table_style: :standard,       # :standard, :compact, :wide
    min_column_width: 3,          # Minimum column width
    max_column_width: 50,         # Maximum column width (for :compact style)

    # Missing behaviors analysis
    summary_style: :grouped       # :grouped, :flat, :detailed
  )
```

### Footer Styles

#### Default Footer
```markdown
---
_Report generated by ClassMetrix gem_
```

#### Minimal Footer
```markdown
---
_Generated by ClassMetrix_
```

#### Detailed Footer
```markdown
---
## Report Information
- **Generated by**: [ClassMetrix gem](https://github.com/patrick204nqh/class-metrix)
- **Generated at**: 2024-01-15 14:30:25 UTC
- **Ruby version**: 3.2.0
```

### Missing Behaviors Summary Styles

#### Grouped (Default)
```markdown
## Missing Behaviors Summary

### DatabaseConfig
- `redis_config` - ðŸš« Not defined
- `cache_timeout` - ðŸš« No method

### RedisConfig
- `db_config` - ðŸš« Not defined
```

#### Flat
```markdown
## Missing Behaviors
- **DatabaseConfig**: `redis_config` - ðŸš« Not defined
- **DatabaseConfig**: `cache_timeout` - ðŸš« No method
- **RedisConfig**: `db_config` - ðŸš« Not defined
```

#### Detailed
```markdown
## Missing Behaviors Analysis
**Summary**: 3 missing behaviors across 2 classes

### ðŸš« Not (2 items)
- **DatabaseConfig**: `redis_config` - ðŸš« Not defined
- **RedisConfig**: `db_config` - ðŸš« Not defined

### ðŸš« No (1 items)
- **DatabaseConfig**: `cache_timeout` - ðŸš« No method
```

## ðŸ“„ CSV Output Configuration

### Basic CSV Configuration

```ruby
ClassMetrix.extract(:constants)
  .from([User, Admin])
  .to_csv(
    "report.csv",                 # File path
    title: "Custom CSV Report",   # Report title

    # Content options
    show_metadata: true,          # Show comment headers
    comment_char: "#",            # Comment character for metadata

    # CSV formatting
    separator: ",",               # Column separator (comma, semicolon, tab)
    quote_char: '"',              # Quote character
    null_value: "",               # Value for nil/missing data

    # Hash handling
    flatten_hashes: true,         # Flatten hashes into separate columns
                                  # false = expand into sub-rows
  )
```

### Hash Handling Options

```ruby
# Option 1: Hash flattening (separate columns for each hash key)
ClassMetrix.extract(:constants)
  .from([DatabaseConfig, RedisConfig])
  .expand_hashes
  .to_csv("config_flat.csv", flatten_hashes: true)

# Option 2: Hash expansion (sub-rows for hash keys)
ClassMetrix.extract(:constants)
  .from([DatabaseConfig, RedisConfig])
  .expand_hashes
  .to_csv("config_expanded.csv", flatten_hashes: false)
```

## ðŸ› Debug Configuration

### Debug Levels

```ruby
# Basic debugging (default)
ClassMetrix.extract(:constants)
  .from([ServiceA, ServiceB])
  .debug(:basic)    # Key decisions and summaries only
  .to_markdown

# Detailed debugging
ClassMetrix.extract(:constants)
  .from([ServiceA, ServiceB])
  .debug(:detailed) # More context and intermediate steps
  .to_markdown

# Verbose debugging
ClassMetrix.extract(:constants)
  .from([ServiceA, ServiceB])
  .debug(:verbose)  # Full details including individual value processing
  .to_markdown
```

### Debug Features

- **Safe Object Inspection**: Handles objects with problematic `inspect`/`to_s` methods
- **Hash Detection Analysis**: Shows why objects are/aren't treated as expandable hashes
- **Smart Logging**: Reduces spam by grouping related operations and focusing on key decisions
- **Error Diagnostics**: Detailed error context for troubleshooting

## ðŸ›¡ï¸ Error Handling

### Error Indicators

When using `.handle_errors`, ClassMetrix uses these indicators:

- **ðŸš« Not defined** - Constant/method doesn't exist
- **ðŸš« No method** - Method doesn't exist
- **âš ï¸ Error: msg** - Runtime error with context
- **âŒ** - nil or false values
- **âœ…** - true values
- **â€”** - Missing hash key

### Example

```ruby
ClassMetrix.extract(:class_methods)
  .from([ServiceA, ServiceB])
  .handle_errors
  .to_markdown

# Output includes error indicators:
# | Method | ServiceA | ServiceB |
# |--------|----------|----------|
# | config | {...}    | ðŸš« Not defined |
# | setup  | âœ…       | âš ï¸ Error: ArgumentError |
```

## ðŸ” Filtering Configuration

### Pattern Filtering

```ruby
# Single pattern
ClassMetrix.extract(:constants)
  .from([User, Admin])
  .filter(/^ROLE_/)
  .to_markdown

# Multiple patterns (OR logic)
ClassMetrix.extract(:constants)
  .from([User, Admin])
  .filter(/^ROLE_/, /^PERMISSION_/, /^STATUS_/)
  .to_markdown

# Combine with other modifiers
ClassMetrix.extract(:constants)
  .from([User, Admin])
  .strict
  .with_private
  .filter(/^INTERNAL_/, /^PRIVATE_/)
  .to_markdown
```

## ðŸ“Š Hash Expansion Configuration

### Basic Hash Expansion

```ruby
# Enable hash expansion
ClassMetrix.extract(:constants)
  .from([DatabaseConfig, RedisConfig])
  .expand_hashes
  .to_markdown

# Output includes sub-rows:
# | Constant    | DatabaseConfig | RedisConfig |
# |-------------|----------------|-------------|
# | DB_CONFIG   | {...}          | {...}       |
# | .host       | localhost      | redis.local |
# | .port       | 5432           | â€” (missing) |
```

### Hash Expansion with Different Output Formats

```ruby
# Markdown with expanded view
ClassMetrix.extract(:constants)
  .from([Config])
  .expand_hashes
  .to_markdown("config.md")

# CSV with flattened columns
ClassMetrix.extract(:constants)
  .from([Config])
  .expand_hashes
  .to_csv("config.csv", flatten_hashes: true)

# CSV with sub-rows
ClassMetrix.extract(:constants)
  .from([Config])
  .expand_hashes
  .to_csv("config.csv", flatten_hashes: false)
```

## ðŸŽ¯ Advanced Configuration Examples

### Complete Configuration Example

```ruby
# Maximum configuration example
ClassMetrix.extract(:constants, :class_methods)
  .from([DatabaseService, RedisService, S3Service])
  .strict                               # Class-only scanning
  .with_private                        # Include private members
  .filter(/CONFIG/, /timeout/, /pool/) # Filter behaviors
  .expand_hashes                       # Expand hash values
  .handle_errors                       # Graceful error handling
  .debug(:detailed)                    # Detailed debugging
  .to_markdown("complete_audit.md",
    title: "Complete Service Audit",
    show_metadata: true,
    show_classes: true,
    show_extraction_info: true,
    show_missing_summary: true,
    summary_style: :detailed,
    footer_style: :detailed,
    show_timestamp: true,
    custom_footer: "Generated for production audit",
    table_style: :wide,
    min_column_width: 5,
    max_column_width: 100
  )
```

### Conditional Configuration

```ruby
# Configuration based on environment
debug_level = Rails.env.development? ? :verbose : :basic
show_private = Rails.env.development?

ClassMetrix.extract(:constants, :class_methods)
  .from(service_classes)
  .tap { |extractor| extractor.with_private if show_private }
  .filter(/CONFIG/, /SETTING/)
  .expand_hashes
  .handle_errors
  .debug(debug_level)
  .to_markdown("service_audit.md",
    title: "Service Configuration Audit",
    show_missing_summary: true,
    footer_style: Rails.env.production? ? :minimal : :detailed
  )
```

## ðŸ“‹ Configuration Validation

ClassMetrix validates configuration options and provides helpful error messages:

```ruby
# Invalid table style
ClassMetrix.extract(:constants)
  .from([User])
  .to_markdown("report.md", table_style: :invalid)
# => ArgumentError: Invalid table_style: :invalid. Must be one of: :standard, :compact, :wide

# Invalid debug level
ClassMetrix.extract(:constants)
  .from([User])
  .debug(:invalid)
# => ArgumentError: Invalid debug level: :invalid. Must be one of: :basic, :detailed, :verbose
```

## ðŸš€ Performance Considerations

### Large Class Sets

For analyzing many classes, consider:

```ruby
# Use strict mode to reduce scope
ClassMetrix.extract(:constants)
  .from(large_class_array)
  .strict                    # Faster than comprehensive scanning
  .filter(/^PUBLIC_/)        # Reduce behaviors to analyze
  .to_csv("large_audit.csv") # CSV is faster for large datasets
```

### Memory Usage

```ruby
# For memory-sensitive environments
ClassMetrix.extract(:constants)
  .from(classes)
  .strict                    # Reduces inheritance tree traversal
  .filter(/essential_only/)  # Limit to essential behaviors
  .debug(:basic)             # Minimize debug output
  .to_markdown("report.md",
    show_missing_summary: false, # Reduces memory usage
    table_style: :compact        # Smaller output
  )
```
